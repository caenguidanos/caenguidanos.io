#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

BRANCH="$(git branch --show-current)"

if [ "$SKIP_CHECK" == "true" ]; then
   echo "CAUTION: Skipping pre-commit hook"
else
   if [ "$BRANCH" == "main" ]; then
      echo "ERROR: You can't commit to protected main"
      exit 1
   fi

   # Lint github/workflows yaml files
   node ./node_modules/yaml-lint/cli.js "$PWD"/.github/workflows/CI-CD.yaml
   node ./node_modules/yaml-lint/cli.js "$PWD"/.github/workflows/CI-CD-release.yaml
   node ./node_modules/yaml-lint/cli.js "$PWD"/.github/workflows/CI-CD-production.yaml

   pnpm lint
   pnpm format

   # Add changes to commit
   git add .
fi
