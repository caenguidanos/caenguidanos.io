#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Check first if we are commiting to protected
BRANCH="$(git branch --show-current)"

if [ "$BRANCH" == "main" ]; then
   echo "You can't commit to protected main"
   exit 1
fi

if [ "$BRANCH" == "staging" ]; then
   echo "You can't commit to protected staging"
   exit 1
fi

if [ "$BRANCH" == "development" ]; then
   echo "You can't commit to protected development"
   exit 1
fi

if [ "$BRANCH" =~ '/^((feature|bugfix|hotfix|experimental)\/(issue-[0-9]+$)|release\/[0-9]\.[0-9]\.[0-9]$)$/g' ]; then
   # Lint github/workflows yaml files
   sh "$PWD"/.github/scripts/yaml-linter.sh

   # Lint app
   pnpm lint

   # Format workspace
   pnpm format

   # Add changes to commit
   git add .

else
   echo "Invalid branch name."
fi
